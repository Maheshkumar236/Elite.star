<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Arena Pro - Full Feature</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #05050a; color: white; }
        .glass { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .orange-glow { box-shadow: 0 0 20px rgba(234, 88, 12, 0.2); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        input:focus { border-color: #ea580c !important; }
        .tab-active { color: #ea580c; transform: scale(1.1); }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="pb-32 selection:bg-orange-600/30">

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-[200] bg-[#05050a] flex items-center justify-center">
        <div class="text-center">
            <i data-lucide="zap" class="w-12 h-12 text-orange-600 animate-bounce mx-auto"></i>
            <p class="font-black italic text-orange-600 animate-pulse mt-4">ELITE ARENA...</p>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast-container" class="fixed top-10 left-1/2 -translate-x-1/2 z-[300] pointer-events-none"></div>

    <!-- Header -->
    <header class="fixed top-0 inset-x-0 h-16 glass flex items-center justify-between px-6 z-50">
        <h1 class="font-black italic text-lg uppercase text-orange-600 tracking-tighter">ELITE PRO</h1>
        <div id="wallet-display" class="px-4 py-1.5 rounded-2xl bg-white/5 border border-white/10 flex items-center gap-2 text-xs font-black">
            <i data-lucide="wallet" class="w-3.5 h-3.5 text-green-500"></i> ₹<span id="user-balance">0</span>
        </div>
    </header>

    <!-- Global Alert (Jo original React file mein tha) -->
    <div id="global-alert-container" class="fixed top-20 inset-x-6 z-40 hidden">
        <div class="bg-orange-600 text-white p-3 rounded-2xl flex items-center gap-3 shadow-2xl animate-bounce">
            <i data-lucide="bell" class="w-4 h-4"></i>
            <p id="alert-text" class="text-[10px] font-bold uppercase"></p>
        </div>
    </div>

    <!-- Main Screens -->
    <main id="app-screens" class="pt-24 px-6 max-w-lg mx-auto">
        
        <!-- Login Screen (Visible when !user) -->
        <div id="screen-auth" class="min-h-[70vh] flex flex-col items-center justify-center text-center space-y-8 hidden">
            <div id="recaptcha-container"></div>
            <i data-lucide="zap" class="w-16 h-16 text-orange-600 mx-auto"></i>
            <h2 class="text-4xl font-black italic uppercase">Elite Login</h2>
            
            <div id="auth-step-1" class="w-full space-y-4">
                <input id="auth-phone" type="tel" placeholder="Mobile Number" maxlength="10" class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 outline-none font-bold">
                <button onclick="sendOTP()" id="btn-otp" class="w-full bg-orange-600 py-5 rounded-2xl font-black">GET OTP</button>
            </div>

            <div id="auth-step-2" class="w-full space-y-4 hidden">
                <input id="auth-otp" type="text" placeholder="6-Digit OTP" maxlength="6" class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 text-center tracking-[1em] outline-none font-bold">
                <button onclick="verifyOTP()" id="btn-verify" class="w-full bg-orange-600 py-5 rounded-2xl font-black">VERIFY</button>
            </div>
        </div>

        <!-- Home: Matches -->
        <div id="screen-home" class="space-y-6 animate-slide-up">
            <div id="match-list" class="space-y-6">
                <!-- Matches Inject Here -->
            </div>
        </div>

        <!-- Lobby: Chat -->
        <div id="screen-lobby" class="hidden space-y-4 h-[70vh] flex flex-col animate-slide-up">
            <h2 class="text-2xl font-black italic uppercase">Global Lobby</h2>
            <div id="chat-messages" class="flex-1 overflow-y-auto space-y-3 pr-2 hide-scrollbar">
                <!-- Chat Inject Here -->
            </div>
            <div class="flex gap-2 bg-white/5 p-2 rounded-2xl border border-white/10">
                <input id="chat-input" placeholder="Type message..." class="bg-transparent flex-1 outline-none px-2 font-bold text-sm">
                <button onclick="sendChatMessage()" class="bg-orange-600 p-3 rounded-xl">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>

        <!-- Settings: Profile -->
        <div id="screen-settings" class="hidden space-y-6 animate-slide-up pb-12">
            <h2 id="admin-trigger" class="text-2xl font-black italic uppercase flex items-center gap-2 cursor-pointer">
                <i data-lucide="settings" class="text-orange-500"></i> PROFILE
            </h2>
            <div class="bg-white/5 p-8 rounded-[3rem] border border-white/10 text-center space-y-4 orange-glow">
                <div class="relative w-32 h-32 mx-auto">
                    <img id="profile-pic" src="https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&q=80&w=200" class="w-32 h-32 rounded-3xl border-4 border-orange-600/20 object-cover" alt="P">
                    <div class="absolute -bottom-2 -right-2 bg-orange-600 px-2 py-1 rounded-lg text-[10px] font-black">PRO</div>
                </div>
                <h4 id="profile-name" class="font-black text-2xl text-orange-500 uppercase italic">@GAMER</h4>
                <div class="grid grid-cols-2 gap-2 text-[10px] font-black uppercase">
                    <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                        <p class="text-gray-500">Level</p>
                        <p id="profile-level" class="text-white">1</p>
                    </div>
                    <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                        <p class="text-gray-500">XP</p>
                        <p id="profile-xp" class="text-white">10</p>
                    </div>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5 flex justify-between items-center">
                    <div class="text-left">
                        <p class="text-[8px] text-gray-500 font-bold">REFERRAL CODE</p>
                        <p id="ref-code" class="text-sm font-black text-orange-500 tracking-widest">---</p>
                    </div>
                    <button onclick="copyReferral()" class="p-2 bg-orange-600/20 text-orange-500 rounded-lg">
                        <i data-lucide="copy" class="w-4 h-4"></i>
                    </button>
                </div>
                <button onclick="handleLogout()" class="w-full bg-red-600/10 text-red-500 py-4 rounded-2xl font-black border border-red-600/20">LOGOUT</button>
            </div>
        </div>
    </main>

    <!-- Navigation -->
    <nav id="bottom-nav" class="fixed bottom-6 inset-x-6 h-20 glass rounded-[2.5rem] flex items-center justify-around px-3 z-50 hidden">
        <button onclick="switchTab('home')" id="nav-home" class="nav-btn flex flex-col items-center gap-1 tab-active">
            <i data-lucide="trophy" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase italic">Home</span>
        </button>
        <button onclick="switchTab('lobby')" id="nav-lobby" class="nav-btn flex flex-col items-center gap-1 text-gray-500">
            <i data-lucide="message-square" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase italic">Lobby</span>
        </button>
        <button onclick="switchTab('settings')" id="nav-settings" class="nav-btn flex flex-col items-center gap-1 text-gray-500">
            <i data-lucide="settings" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase italic">Profile</span>
        </button>
    </nav>

    <!-- Modals -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-8 hidden">
        <!-- Join Modal -->
        <div id="modal-join" class="bg-[#0c0c0c] border border-orange-600/20 p-8 rounded-[3rem] w-full max-w-sm space-y-6 hidden animate-slide-up">
            <div class="text-center">
                <h3 id="join-title" class="text-xl font-black italic uppercase">MATCH NAME</h3>
                <p id="join-fee" class="text-xs text-orange-500 font-bold">FEE: ₹0</p>
            </div>
            <div class="space-y-4">
                <input id="join-ign" placeholder="In-Game Name (IGN)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white outline-none font-bold">
                <input id="join-uid" placeholder="Game UID" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white outline-none font-bold">
            </div>
            <button onclick="confirmJoin()" id="btn-join-final" class="w-full bg-orange-600 py-4 rounded-xl font-black text-white">CONFIRM JOIN</button>
            <button onclick="closeModals()" class="w-full text-gray-500 font-bold text-xs uppercase">Back</button>
        </div>
        
        <!-- Admin Modal (Secret) -->
        <div id="modal-admin" class="bg-[#0c0c0c] border border-green-600/20 p-8 rounded-[3rem] w-full max-w-sm space-y-4 hidden">
            <h3 class="text-xl font-black italic text-green-500">ADMIN UNLOCKED</h3>
            <div class="space-y-2">
                <button onclick="adminAction('create')" class="w-full bg-white/5 p-3 rounded-xl text-left font-bold text-xs uppercase">+ Create Match</button>
                <button onclick="adminAction('alert')" class="w-full bg-white/5 p-3 rounded-xl text-left font-bold text-xs uppercase">Send Global Alert</button>
            </div>
            <button onclick="closeModals()" class="w-full text-gray-500 font-bold text-xs">Close</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithPhoneNumber, RecaptchaVerifier, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";

        // CONFIG (Replace with your actual Firebase config)
        const firebaseConfig = {
  apiKey: "AIzaSyDPChNIAQz0gEmsuDFpACl0XvWm-DNcf2k",
  authDomain: "eliteweb-5b512.firebaseapp.com",
  projectId: "eliteweb-5b512",
  storageBucket: "eliteweb-5b512.firebasestorage.app",
  messagingSenderId: "474751993215",
  appId: "1:474751993215:web:88be5ffccdd88651cf464a",
  measurementId: "G-9HZY4280CY"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const functions = getFunctions(app);
        const appId = "elite_pro_final_v3";

        // Global State
        let user = null;
        let userData = null;
        let confirmationResult = null;
        let selectedMatch = null;
        let adminTapCount = 0;

        // AUTH LOGIC
        window.sendOTP = async () => {
            const phone = document.getElementById('auth-phone').value;
            if(phone.length < 10) return showToast("Invalid Number", "error");
            
            loadingBtn('btn-otp', true);
            if(!window.recaptchaVerifier) {
                window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', { 'size': 'invisible' });
            }

            try {
                confirmationResult = await signInWithPhoneNumber(auth, `+91${phone}`, window.recaptchaVerifier);
                document.getElementById('auth-step-1').classList.add('hidden');
                document.getElementById('auth-step-2').classList.remove('hidden');
                showToast("OTP Sent!");
            } catch (err) {
                showToast("Error sending SMS", "error");
            } finally { loadingBtn('btn-otp', false, "GET OTP"); }
        };

        window.verifyOTP = async () => {
            const otp = document.getElementById('auth-otp').value;
            loadingBtn('btn-verify', true);
            try {
                await confirmationResult.confirm(otp);
                showToast("Verified!");
            } catch (err) {
                showToast("Invalid OTP", "error");
            } finally { loadingBtn('btn-verify', false, "VERIFY"); }
        };

        window.handleLogout = () => signOut(auth).then(() => showToast("Logged Out"));

        // REAL-TIME SYNC
        onAuthStateChanged(auth, (u) => {
            user = u;
            document.getElementById('loading-screen').classList.add('hidden');
            
            if(user) {
                document.getElementById('screen-auth').classList.add('hidden');
                document.getElementById('bottom-nav').classList.remove('hidden');
                syncProfile();
                syncMatches();
                syncChat();
                syncAlerts();
            } else {
                document.getElementById('screen-auth').classList.remove('hidden');
                document.getElementById('bottom-nav').classList.add('hidden');
            }
        });

        const syncProfile = () => {
            const profileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data');
            onSnapshot(profileRef, (ds) => {
                if(ds.exists()) {
                    userData = ds.data();
                    updateProfileUI();
                }
            });
        };

        const syncMatches = () => {
            const matchesRef = collection(db, 'artifacts', appId, 'public', 'data', 'matches');
            onSnapshot(matchesRef, (snap) => {
                const list = document.getElementById('match-list');
                const matches = snap.docs.map(d => ({id: d.id, ...d.data()}));
                list.innerHTML = matches.map(m => `
                    <div class="bg-white/5 border border-white/10 p-6 rounded-[2rem] border-l-4 border-l-orange-600 relative overflow-hidden group">
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="text-xl font-black italic uppercase leading-tight">${m.title}</h5>
                                <p class="text-[10px] font-bold text-gray-500 uppercase mt-1">Map: ${m.map || 'Bermuda'} | Mode: ${m.mode || 'Solo'}</p>
                            </div>
                            <div class="bg-green-600/20 text-green-500 px-3 py-1 rounded-xl text-[10px] font-black italic">₹${m.prizePool} PRIZE</div>
                        </div>
                        <div class="mt-6 flex justify-between items-end">
                            <div class="flex flex-col gap-1">
                                <span class="text-[8px] font-black text-gray-500 uppercase">ENTRY FEE: ₹${m.entryFee}</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-32 h-1.5 bg-white/5 rounded-full overflow-hidden">
                                        <div class="h-full bg-orange-600" style="width: ${(m.joinedCount/m.maxPlayers)*100}%"></div>
                                    </div>
                                    <span class="text-[9px] font-black">${m.joinedCount}/${m.maxPlayers}</span>
                                </div>
                            </div>
                            <button onclick="openJoinModal('${m.id}', '${m.title}', ${m.entryFee})" class="px-8 py-2.5 bg-orange-600 rounded-xl text-xs font-black italic shadow-lg shadow-orange-600/20 active:scale-90 transition-all">JOIN</button>
                        </div>
                    </div>
                `).join('');
            });
        };

        const syncChat = () => {
            const chatRef = collection(db, 'artifacts', appId, 'public', 'data', 'chat');
            onSnapshot(chatRef, (snap) => {
                const container = document.getElementById('chat-messages');
                const messages = snap.docs.map(d => d.data()).sort((a,b) => a.timestamp - b.timestamp).slice(-30);
                container.innerHTML = messages.map(m => `
                    <div class="bg-white/5 p-3 rounded-2xl border border-white/5 animate-slide-up">
                        <p class="text-[8px] font-black text-orange-500 uppercase">${m.username}</p>
                        <p class="text-xs font-medium text-gray-200 mt-1">${m.text}</p>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
            });
        };

        const syncAlerts = () => {
            const alertsRef = collection(db, 'artifacts', appId, 'public', 'data', 'alerts');
            onSnapshot(alertsRef, (snap) => {
                const latest = snap.docs.map(d => d.data()).sort((a,b) => b.timestamp - a.timestamp)[0];
                if(latest && latest.timestamp > Date.now() - 300000) {
                    document.getElementById('global-alert-container').classList.remove('hidden');
                    document.getElementById('alert-text').innerText = latest.msg;
                    setTimeout(() => document.getElementById('global-alert-container').classList.add('hidden'), 5000);
                }
            });
        };

        // UI ACTIONS
        window.switchTab = (tab) => {
            document.querySelectorAll('#app-screens > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`screen-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`nav-${tab}`).classList.add('tab-active');
            lucide.createIcons();
        };

        const updateProfileUI = () => {
            document.getElementById('user-balance').innerText = userData.balance || 0;
            document.getElementById('profile-name').innerText = `@${userData.username}`;
            document.getElementById('profile-xp').innerText = userData.xp || 0;
            document.getElementById('profile-level').innerText = Math.floor((userData.xp || 0) / 10) + 1;
            document.getElementById('ref-code').innerText = userData.referralCode || user.uid.slice(0,6).toUpperCase();
        };

        // SECRET ADMIN TRIGGER (Exactly like React file)
        document.getElementById('admin-trigger').addEventListener('click', () => {
            adminTapCount++;
            if(adminTapCount >= 10) {
                adminTapCount = 0;
                showModal('modal-admin');
                showToast("Admin Unlocked", "success");
            }
        });

        window.openJoinModal = (id, title, fee) => {
            selectedMatch = { id, title, fee };
            document.getElementById('join-title').innerText = title;
            document.getElementById('join-fee').innerText = `FEE: ₹${fee}`;
            showModal('modal-join');
        };

        window.confirmJoin = async () => {
            const ign = document.getElementById('join-ign').value;
            const uid = document.getElementById('join-uid').value;
            if(!ign || !uid) return showToast("Enter Details", "error");
            
            loadingBtn('btn-join-final', true);
            try {
                // IMPORTANT: Production mein yahan HttpsCallable use karein
                // Filhal functionality ke liye join function ko call karein (Logic same as React)
                const joinFn = httpsCallable(functions, 'joinMatch');
                const res = await joinFn({ appId, matchId: selectedMatch.id, ign, uid });
                if(res.data.success) {
                    showToast("Joined Successfully!");
                    closeModals();
                }
            } catch (err) {
                showToast(err.message || "Join Failed", "error");
            } finally { loadingBtn('btn-join-final', false, "CONFIRM JOIN"); }
        };

        window.sendChatMessage = async () => {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text) return;
            input.value = '';
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'chat'), {
                username: userData?.username || "Gamer",
                text,
                timestamp: Date.now()
            });
        };

        // UTILS
        window.showToast = (msg, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `px-6 py-4 rounded-3xl shadow-2xl bg-orange-600 text-white font-black italic text-xs mb-3 animate-slide-up transition-all pointer-events-auto`;
            toast.innerText = msg;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        };

        window.showModal = (id) => {
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.querySelectorAll('#modal-overlay > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };

        window.closeModals = () => document.getElementById('modal-overlay').classList.add('hidden');

        const loadingBtn = (id, loading, text) => {
            const btn = document.getElementById(id);
            btn.disabled = loading;
            btn.innerHTML = loading ? `<i data-lucide="loader-2" class="w-5 h-5 animate-spin mx-auto"></i>` : text;
            lucide.createIcons();
        };

        window.copyReferral = () => {
            const code = document.getElementById('ref-code').innerText;
            navigator.clipboard.writeText(code);
            showToast("Code Copied!");
        };

        lucide.createIcons();
    </script>
</body>
</html>

